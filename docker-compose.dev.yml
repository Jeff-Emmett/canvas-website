# Canvas Website - Dev Branch Deployment
# Automatically deploys from `dev` branch for testing
# Access at: staging.jeffemmett.com

services:
  canvas-dev:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_WORKER_ENV=staging
    container_name: canvas-dev
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-public"
      - "traefik.http.services.canvas-dev.loadbalancer.server.port=80"
      - "traefik.http.routers.canvas-dev.rule=Host(`staging.jeffemmett.com`)"
      - "traefik.http.routers.canvas-dev.entrypoints=web"
      - "traefik.http.routers.canvas-dev.service=canvas-dev"
    networks:
      - traefik-public
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  traefik-public:
    external: true
